<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Домашнее задание CDNvideo. Фронтенд</title>
	<link rel="stylesheet" href="./style.css" />
</head>
	
	  <body>
		<script src="https://cdn.jsdelivr.net/npm/hls.js@1"></script>
	
		<wrapper>
		  <h1>Домашнее задание CDNvideo. Фронтенд</h1>
		  <video height="600" id="video" controls></video>
		  <div id="update"></div>
		</wrapper>
		  <script>
			if (Hls.isSupported()) {
			  var video = document.getElementById('video');
			  var hls = new Hls();
			  hls.loadSource('https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8');
			  hls.attachMedia(video);
			  hls.on(Hls.Events.MEDIA_ATTACHED, function () {
				video.muted = true;
				video.play();
			  });
			}
		  </script>
		  <script>
			var video = document.getElementById('video');
			window.onload = function () {
			  var i = 0;
			  var el = document.getElementById('update');

			function foo() {
			  const r = video.buffered;
			  const pos = video.currentTime;
			  let bufferLen = 0;
			  for (let i = 0; i < r.length; i++) {
				if (pos >= r.start(i) && pos < r.end(i)) {
					bufferLen = r.end(i) - pos;
				}
			  }
				el.innerHTML =
				  '<div>currentTime:' + pos + '</div>'+ 
				  '<div>buffered:' + bufferLen + '</div>'+ 
				  '<div>decoded:' + video.webkitDecodedFrameCount + '</div>'+
				  '<div>dropped:' + video.webkitDroppedFrameCount + '</div>';
				window.requestAnimationFrame(foo);
			  }
			  foo();
			};
		  </script>
		 
	  </body>
</html>